// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:dev.db"
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  name       String
  joined_on  DateTime @default(now())
  last_login DateTime @default(now())

  preferences PreferencesProfile?
  financials  FinancialProfile?
}

// UI, Notifications, UX preferences
model PreferencesProfile {
  id     String @id @default(cuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique

  lang                String  @default("EN")
  notifications_push  Boolean @default(false)
  notifications_email Boolean @default(true)
}

model FinancialProfile {
  id     String @id @default(cuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique

  expenses    Expense[]
  incomes     Income[]
  loans       Loan[]
  cashes      Cash[]
  investments Investment[]

  snapshots Snapshot[]
}

// Financial objects

model Expense {
  id         Int              @id @default(autoincrement())
  profile    FinancialProfile @relation(fields: [profileId], references: [id])
  profileId  String           @unique
  Snapshot   Snapshot?        @relation(fields: [snapshotId], references: [id])
  snapshotId Int?

  name   String /// Max should be 50 chars
  desc   String? /// Max should be 100 chars
  amount Float
  date   DateTime

  /// in hours, 0 = no repetition
  recurring_delay Int
  /// repetitions after the initial transaction, 0 for eternal repetition.
  iterations      Int
  /// true to compound by taking into account the fraction of a started period.
  continuous      Boolean

  /// in hours, 0 = no interests, 0.10 = 10% interests, -0.10 = -10%
  interests_percent    Float
  /// in hours, 0 = no interests
  interests_delay      Int
  /// true to compound the interests every ms/seconds/min; false to only compound at the end of period.
  interests_continuous Boolean
}

model Income {
  id         Int              @id @default(autoincrement())
  profile    FinancialProfile @relation(fields: [profileId], references: [id])
  profileId  String           @unique
  Snapshot   Snapshot?        @relation(fields: [snapshotId], references: [id])
  snapshotId Int?

  name   String /// Max should be 50 chars
  desc   String? /// Max should be 100 chars
  amount Float
  date   DateTime

  /// in hours, 0 = no repetition
  recurring_delay Int
  /// repetitions after the initial transaction, 0 for eternal repetition.
  iterations      Int
  /// true to compound by taking into account the fraction of a started period.
  continuous      Boolean

  /// in hours, 0 = no interests, 0.10 = 10% interests, -0.10 = -10%
  interests_percent    Float
  /// in hours, 0 = no interests
  interests_delay      Int
  /// true to compound the interests every ms/seconds/min; false to only compound at the end of period.
  interests_continuous Boolean
}

model Loan {
  id         Int              @id @default(autoincrement())
  profile    FinancialProfile @relation(fields: [profileId], references: [id])
  profileId  String           @unique
  Snapshot   Snapshot?        @relation(fields: [snapshotId], references: [id])
  snapshotId Int?

  name   String /// Max should be 50 chars
  desc   String? /// Max should be 100 chars
  amount Float
  date   DateTime

  /// in hours, 0 = no interests, 0.10 = 10% interests, -0.10 = -10%
  interests_percent    Float
  /// in hours, 0 = no interests
  interests_delay      Int
  /// true to compound the interests every ms/seconds/min; false to only compound at the end of period.
  interests_continuous Boolean
}

model Cash {
  id         Int              @id @default(autoincrement())
  profile    FinancialProfile @relation(fields: [profileId], references: [id])
  profileId  String           @unique
  Snapshot   Snapshot?        @relation(fields: [snapshotId], references: [id])
  snapshotId Int?

  name   String /// Max should be 50 chars
  desc   String? /// Max should be 100 chars
  amount Float
  date   DateTime
}

model Investment {
  id         Int              @id @default(autoincrement())
  profile    FinancialProfile @relation(fields: [profileId], references: [id])
  profileId  String           @unique
  Snapshot   Snapshot?        @relation(fields: [snapshotId], references: [id])
  snapshotId Int?

  name   String /// Max should be 50 chars
  desc   String? /// Max should be 100 chars
  amount Float
  date   DateTime

  /// in hours, 0 = no repetition
  recurring_delay Int
  /// repetitions after the initial transaction, 0 for eternal repetition.
  iterations      Int
  /// true to compound by taking into account the fraction of a started period.
  continuous      Boolean

  /// in hours, 0 = no interests, 0.10 = 10% interests, -0.10 = -10%
  interests_percent    Float
  /// in hours, 0 = no interests
  interests_delay      Int
  /// true to compound the interests every ms/seconds/min; false to only compound at the end of period.
  interests_continuous Boolean
}

// Financial snapshot

model Snapshot {
  id        Int              @id @default(autoincrement())
  profile   FinancialProfile @relation(fields: [profileId], references: [id])
  profileId String           @unique

  last_updated DateTime @default(now())

  /// All financial objects to consider in the calculation of the total expense, loans, ...
  expenses    Expense[]
  incomes     Income[]
  loans       Loan[]
  cashes      Cash[]
  investments Investment[]

  /// Calculate the total_* per on `date`
  date             DateTime @default(now())
  expires          DateTime
  total_expense    Int
  total_income     Int
  total_loan       Int
  total_cash       Int
  total_investment Int
  net_worth        Int
}
